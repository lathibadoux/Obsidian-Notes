## ==Question:==

Write a solution to find all dates' `id` with higher temperatures compared to its previous dates (yesterday).

**Input:** 
Weather table:
+----+------------+-------------+
| id | recordDate | temperature |
+----+------------+-------------+
| 1  | 2015-01-01 | 10          |
| 2  | 2015-01-02 | 25          |
| 3  | 2015-01-03 | 20          |
| 4  | 2015-01-04 | 30          |
+----+------------+-------------+
**Output:** 
+----+
| id |
+----+
| 2  |
| 4  |
+----+

## ==Optimal Solution:==

If allowed...
```sql
SELECT id
FROM (
  SELECT id,
         recordDate,
         temperature,
         LAG(temperature) OVER (ORDER BY recordDate) AS prev_temp,
         LAG(recordDate)   OVER (ORDER BY recordDate) AS prev_date
  FROM Weather
) t
WHERE DATEDIFF(recordDate, prev_date) = 1
  AND temperature > prev_temp;
```
Window functions are faster for this solution because you can put an index on the ORDER BY.

## ==Other Solutions:==
```sql
SELECT w1.id
FROM Weather w1, Weather w2
WHERE DATEDIFF(w1.recordDate, w2.recordDate) = 1 AND w1.temperature > w2.temperature;
```
* The slowest solution because a function is put on both sides of the join predicate, so the engine can't use an index on either side.  Usually degenerates into scanning lots of row pairs.

**Self-Join on Consecutive Dates with DATEDIFF:
```sql
SELECT w1.id
FROM Weather w1
JOIN Weather w2
  ON DATEDIFF(w1.recordDate, w2.recordDate) = 1
WHERE w1.temperature > w2.temperature;
```
* Slower because if the join predicate applies a function to the join columns, the database can't use the index on that column effectively.
* You also must apply the function to each candidate's row value before it can compare.  Means you will have to make a full table scan on both sides of the table.

**LEFT JOIN on a derived table:**
```sql
select a.id 
from weather as a 
left join (select date_add(recordDate, interval 1 day) as recordDate
, temperature from weather) as b on a.recordDate = b.recordDate 
where a.temperature > b.temperature;
```
* Slower because you cannot use an index on a derived table.
