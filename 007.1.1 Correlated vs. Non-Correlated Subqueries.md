### How to Identify a Correlated Subquery
  A subquery is correlated when it references columns from the outer query.
  ---
  **Simple Rule of Thumb:**
  Ask yourself: "Can this subquery run independently without the outer query?"

  - âœ… YES â†’ Non-correlated (runs once, independent)
  - âŒ NO â†’ Correlated (runs multiple times, dependent on outer query)
  ---
### Visual Comparison

  **Non-Correlated Subquery** âœ…

```sql
  SELECT name
  FROM Employee
  WHERE id IN (
      SELECT managerId       -- âœ… No reference to outer query
      FROM Employee
      GROUP BY managerId
      HAVING COUNT(*) >= 5
  )
  ```
  
  ==Key: The subquery doesn't mention anything from the outer Employee table.==

  You could run it standalone:
  -- This works by itself!

```sql
  SELECT managerId
  FROM Employee
  GROUP BY managerId
  HAVING COUNT(*) >= 5
```
  ---
  **Correlated Subquery** âŒ

```sql
  SELECT e.name
  FROM Employee e
  WHERE EXISTS (
      SELECT 1
      FROM Employee r
      WHERE r.managerId = e.id  -- âŒ References outer table 'e.id'
      GROUP BY r.managerId
      HAVING COUNT(*) >= 5
  );
```
  
  ==Key: WHERE r.managerId = e.id references e from the outer query.==

  You cannot run it standalone:
  -- This fails! What is 'e.id'?
```sql
  SELECT 1
  FROM Employee r
  WHERE r.managerId = e.id  -- âŒ Error: 'e' is undefined
```
  ---
### Why Does This Matter?

  **Non-Correlated Subquery:**
  1. Execute subquery ONCE
  2. Get results: [101, 203, 405]
  3. Filter outer query with those results
  
  ==Executions: 1 subquery + 1 outer query = 2 total==

  **Correlated Subquery (1000 rows):**
  For row 1: Execute subquery
  For row 2: Execute subquery
  For row 3: Execute subquery
  ...
  For row 1000: Execute subquery
  
 ==Executions: 1000 subqueries + 1 outer query = 1001 total ğŸ’¥==

---
### Quick Detection Checklist

  **Look for these patterns in the subquery:**

  | Pattern                           | Type                 | Example                                      |
  |-----------------------------------|----------------------|----------------------------------------------|
  | No reference to outer table alias | âœ… Non-correlated     | WHERE id IN (SELECT managerId FROM Employee) |
  | References outer table column     | âŒ Correlated         | WHERE r.managerId = e.id                     |
  | Uses EXISTS with outer reference  | âŒ Usually correlated | WHERE EXISTS (... WHERE x.id = outer.id)     |
  | Standalone subquery works         | âœ… Non-correlated     | Can copy/paste and run alone                 |
  | Standalone subquery fails         | âŒ Correlated         | Needs outer query context                    |

  ---
### When Are Correlated Subqueries OK?
Sometimes they're necessary or even optimal:

 **Good Use Case:**
  -- Find employees earning more than their department average

```sql
  SELECT name, salary
  FROM Employee e
  WHERE salary > (
      SELECT AVG(salary)
      FROM Employee
      WHERE department = e.department  -- Correlated but necessary
  );
```

  This is hard to rewrite without correlation, and with proper indexes on department, it can be efficient.
  
---
### Summary

  ==Correlated Subquery = References outer query columns==

  Quick Test: Can I copy/paste the subquery and run it alone?
  - YES â†’ Non-correlated (fast) âœ…
  - NO â†’ Correlated (potentially slow) âŒ
